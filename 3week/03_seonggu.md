
# Chapter 2-3 네트워크 기기
보통 가정에 네트워크를 깔면 공인 ip는 하나만 사용한다. 추가로 공인 ip를 사용하면 돈이 꽤 든다고 한다.
또한 유선으로 받은 패킷 정보를 와이파이 등의 무선 통신으로 핸드폰에 날려줘야 할 때가 있다.
이외에도 기업마다 내부 인트라넷 구축을 위해서도 여러 네트워크 장비를 사용한다.    
이 포스팅에서는 OSI 7 계층에서 처리할 수 있는 계층들을 기준으로 정의한 여러 네트워크 기기들을 알아본다.
- 애플리케이션 계층 : L7 스위치
- 인터넷 계층 : 라우터, L3 스위치
- 데이터 링크 계층 : L2 스위치, 브릿지
- 물리 계층 : NIC, 리피터, AP

아래 개념을 미리 알고 있으면 도움이 될 것 같다.
### MAC 주소
데이터 링크 계층에서 통신을 위해 **모든 네트워크 기기에 할당된 고유 식별자**라고 할 수 있다.

## MAC 주소 테이블
**MAC 주소**와 **포트 번호**가 기록된 테이블이다. 브릿지 테이블이라고도 한다.

### 허브
여러 대의 네트워크 장비를 연결해 LAN에 접속하게 하는 장비다.
**받은 데이터 프레임은 허브로 연결된 모든 장비에 다 전송하며 이를 flooding**이라고 한다.
즉, 통신이 필요한 PC 뿐 아니라 다른 PC에도 막무가내로 데이터를 전송하므로 충돌이 발생하거나, 보안이 취약한 단점이 있다.
![](./../../../assets/images/2022-08-12-네트워크기기_images/1660394767994.png)

### 브리지
두 개의 LAN을 상호 접속할 수 있도록 다리 역할을 하는 통신망 연결 장치이다.

### 스위치
여러 장비를 연결하고 데이터 통신을 중재하며 허브와 달리 **목적지가 연결된 포트**로만 전기 신호를 보내는 네트워크 장비이다.
따라서 네트워크 성능도 향상되고, 보안이 강화되며, 충돌도 덜 일어난다.

### 라우터
**다른 네트워크에 존재하는 장치끼리** 서로 데이터를 주고 받을 때 패킷 소모를 최소화하고 
**경로를 최적화하여** 최소 경로로 패킷을 포워딩하는 장비이다.
OSI 7 계층에서 네트워크 계층(TCP/IP 계층에서는 IP 계층이라고 할 수 있는)의 주소를 참조해
해당하는 목적지로 갈 수 있는 최적 루트를 찾는다고 보면 된다.

## 애플리케이션 계층 처리 : L7 스위치
L7 스위치는 로드 밸런서라고도 한다. 
데이터 프레임이 지나는 길(로드)를 최대한 균형있게 만든다고 하여 붙여진 이름이다.
클라이언트로부터 오는 여러 요청들을 뒤쪽의 여러 서버로 나누어 최대한 많은 트래픽을 처리할 수 있도록 한다.
L7가 붙은 네이밍에서 알 수 있듯이, 어플리케이션 계층의 PDU인 메시지를 일정부분 읽고 처리할 수 있기 때문에
url, 캐시, 쿠키등을 기반으로 트래픽을 분산할 수 있다.  바이러스, 불필요한 외부 데이터 등도 걸러낼 수 있다.

### 헬스 체크
L7 스위치가 서버에 트래픽을 분산하려면, 해당 서버가 정상적으로 동작하는 서버인지 알아야 한다.
이를 위해 헬스 체크 과정을 거친다. 전송 주기와 재전송 횟수를 설정하면 반복적으로 서버에 요청을 보내는 것이다.
정상적으로 서버가 응답하지 않으면 해당 서버는 트래픽을 분산할 대상에서 제외한다.

### 서버 이중화
서버를 운영할 시, 트래픽이 이전보다 더 많이 나오거나 갑자기 문제가 발생할 경우를 대비해, 가상 IP를 이용해
안정적인 서버 운영을 할 수 있다. 예를 들어 외부에서는 0.0.012로 서비스를 요청하면,
IP/MAC 주소를 변조하여 해당하는 실제 서버(0.0.013이나 0.0.014 등)으로 트래픽을 요청할 수 있다.

## 인터넷 계층 처리 : L3 스위치, 라우터
L3 스위치는 L2의 스위치 기능과 라우터 기능을 갖춘 장비이다. 
L3 계층의 PDU인 패킷을 분석할 수 있다.
라우팅 테이블을 참조 테이블로 한다.

## 데이터 링크 계층 처리 : L2 스위치, 브릿지
IP 주소를 분석이 어려워 패킷의 MAC주소만 스위칭하는 장비이다.

## 물리 계층을 처리 : NIC, AP
### Network Interface Card (NIC)
LAN카드라고 말이 불리며, 2대 이상의 컴퓨터 네트워크를 구성하는 데 사용된다.
    
### Access Point (AP)
유선 LAN을 통해 전달받은 패킷을 복사해, WIFI 등의 무선 LAN 기술을 사용하여 무선 네트워크를 지원하는 장치이다. 


## 질문

1. 당신이 실시간 웹 서비스를 위한 서버를 구축하기 위해 네트워크 장비를 검색하고 있다. 다음과 같은 조건을 만족하도록 서버 구축 계획을 짜라.     
- 사용자가 서비스를 받기 위해 접근하는 외부 ip 주소는 1개 이다.   
- 서버 1대에 에러가 발생하여 동작이 멈춰도 서비스는 계속 되어야 한다.
- 이 웹서비스는 보안에 민감하기 때문에, 장비 자체에서 데이터에 바이러스 등이 있는지 분석하여 필터링하는 기능을 지원해야 한다. 
 
2. 1의 방법으로 서버 구축을 하려다가, 팀장에게 "그거 구축할 돈은 너의 월급에서 까도 되냐"고 들었다.
 몇 번의 설득 끝에 바이러스 검사는 네트워크 장비에서 처리 하지 않기로 하였다. 이런 상황에서는 어떤 방법을 쓰면 될까?

## Chapter 2-4 IP 주소
IP 주소가 어떻게 구성되고, 어떻게 사용되는지 좀 더 자세히 알아보자.


## Address Resolution Protocol (ARP)
실제로 컴퓨터 간 통신은 IP 주소를 기반으로 하는 것이 아니다. 
정확히는 IP주소가 ARP를 통해 MAC 주소를 찾고 MAC 주소로 통신을 한다.
IP는 원활한 통신 구조를 위한 가상 주소일 뿐이다.



### 브로드캐스트
송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식이다.
장치 A가 연결된 B,C,D PC에 ARP Request를 보내서 ip 주소에 대응하는 MAC주소를 찾게 된다.



### 유니캐스트
고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식이다.
위의 예시에서 장치 B가 ARP reply 유니캐스트를 A에 보내게 된다.


## 클래스 기반 할당 방식
IP 주소는 A,B,C,D,E의 클래스로 나뉘며,
앞 부분을 네트워크 주소, 뒷 부분을 호스트 주소로 사용한다.

A,B,C는 일대일 통신에 사용되고, D는 멀티캐스트 통신, E는 예비용 으로 사용한다.  
![](./../../../assets/images/2022-08-13-IP주소_images/1660410709079.png)

이 방식은 간단하지만, 사용하는 주소보다 많은 주소를 버릴 수도 있고 DHCP, IPv6, NAT 등이 나왔다.
## Dynamic Host Configuration Protocol (DHCP)
IP 주소나 통신 매개변수를 자동으로 할당하기 위한 프로토콜이다.

## Network Address Translation (NAT)
패킷이 라우팅 장치를 통해 전송될때  패킷의 ip 주소 정보를 수정해 다른 주소로 매핑하는 방법이다.
외부망과 내부망을 나누어서 사설 IP를 만드는 데, 이 방법이 쓰이게 된다.    
공유기에는 NAT 기능이 탑재되어 여러 PC를 하나의 공인 IP에 연결할 수 있다.
**사설 IP는 외부에 알려지지 않게 되며, 외부의 공격을 차단할 수 있다.**
- 내부망의 개별 PC가 외부로 통신 가능
- 외부망에서 내부망의 개별 PC에 대해 통신 불가

![](./../../../assets/images/2022-08-13-IP주소_images/1660411281576.png)

## Part Address Translation (PAT)
PAT은 하나의 공인 IP에 PORT를 구분해 사설 PC에 메핑하는 것이다.
PORT(일종의 식별자 역할)를 통해 사설 PC가 구분되며, 따라서 외부에서 내부로 통신이 가능하다.

![](./../../../assets/images/2022-08-13-IP주소_images/1660411272283.png)


## 질문
- 클래스 기반 ip 할당 방식의 단점을 예로 들어 설명하고, 이를 해결하기 위한 방법을 말해라.

# Chapter 2-5 
http (HyperText Transfer Protocol)는 애플리케이션 계층에서 웹 서비스를 위한 프로토콜로 사용된다.
Http의 종류와 특징에 대해 알아본다.

###  RTT
패킷의 왕복시간 (목적지에 도달하고 나서 다시 출발지로 돌아오는 시간) 이다.

## HTTP/1.0
하나의 연결 당 하나의 요청만을 처리하도록 설계되었다.
따라서 요청이 생길 때마다 TCP 3-WAY handshake를 계속해서 열어야 한다.    
이로 인해 RTT가 증가한다. 이를 줄이기 위해 이미지 스플리팅이나 코드 압축을 사용한다.
![](./../../../assets/images/2022-08-14-http_images/1660412556188.png)

## HTTP/1.1
매번 TCP 연결할 필요없이 한 번 TCP 초기화를 하면 keep-alive 옵션으로 여러 파일을 송수신 할 수 있다.
그러나 다수의 리소스를 처리하려면, 리소스 개수에 비례해 대기 시간이 길어진다.    
또한, 헤더에 쿠키 등 많은 메타 데이터가 들어있고 압축이 되지 않아 무거운 단점이 있다.    
![](./../../../assets/images/2022-08-14-http_images/1660413964584.png)


### HOL Blocking
같은 큐에 있는 패킷이 첫 번째 패킷에 의해 지연되는 현상이다.     
아래 이미지를 보면 input 데이터가 switching fabric(입력 포트를 출력포트로 전달하는 과정)를 거쳐 output으로 나온다.
이 때, 1번 input과 4번 input은 동일한 경로로 4번 output으로 보내려고 할 경우, 1번 input의 전달이 지연되는 현상이다.

![](./../../../assets/images/2022-08-14-http_images/1660414158818.png)

## HTTP/2
HTTP/1.X 보다 지연시간을 줄이고, 응답시간을 더 빠르게 하였으며, 다음을 지원한다.
- 멀티플렉싱 : 여러 개의 스트림을 사용해 송수신.
- 헤더 압축 : 허프만 코딩 압축 알고리즘을 사용하는 HPACK 압축 형식을 가진다.
- 서버 푸시 : 클라이언트 요청없이 서버가 리소스를 바로 푸시할 수 있다. 예를 들어, html은 css 파일이 포함될텐데, html을 서버가 읽으면서 css까지 푸시하여 클라이언트에 전달할 수 있어 요청 시간이 단축된다.

HTTP/2는 HTTPS 위에서 동작한다.

## HTTPS
애플리케이션 계층과 전송 계층 사이에 신뢰 계층인 SSL/TLS 계층을 넣어 신뢰할 수 있는 HTTP 요청을 말한다.
통신 암호화를 위해 쓴다.


## 질문
- HTTP와 HTTPS의 차이점은?
- HOL Blocking을 해결하기 위한 방법은?


# Reference
면접을 위한 CS 전공지식 노트 - 주홍철 지음     
['네트워크 장비 정리 블로그'](https://yys630.tistory.com/27)
['클래스 기반 할당 방식'](https://engkimbs.tistory.com/621)
['NAT와 PAT'](https://cheershennah.tistory.com/123)
['http 프로토콜 비교'](https://hirlawldo.tistory.com/106)
